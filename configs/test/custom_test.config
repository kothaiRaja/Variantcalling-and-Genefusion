// ==========================  CAUTION: Chromosome Naming Consistency ========================== //
// Please ensure all reference files (FASTA, GTF, VCF, BED, interval lists, etc.) use consistent chromosome naming.
//
//   Mismatches in contig naming (e.g., "22" vs "chr22") can cause:
//    - Variant calling tools to skip records
//    - Errors during annotation, filtering, or alignment
//    - Unexpected empty results or contig mismatch errors
//
//  Before running the pipeline, validate and standardize chromosome names across:
//    - Reference genome (FASTA + .dict + .fai)
//    - Gene annotations (GTF files)
//    - Known variant VCFs (dbSNP, Mills, etc.)
//    - Intervals and BED files
//	  - Merged_vcf file.(look for headers and also in variant_lists)
//
// Tools like `sed`, `awk`, `bcftools` can help standardize naming conventions.
// ---------------------------------------------------------------------------------------------- //



// ========================== User Parameters Config ========================== //
// This file allows users to override specific parameters without modifying the main configuration.

params {
    // ========================== Base Directories ========================== //
    outdir = "$baseDir/output"
    resultsdir = "$baseDir/results"
    base_dir = "$baseDir"
	build_references = params.build_references ?: false
	build_references_test = params.build_references_test ?: false

    // ========================== Dataset Inputs ========================== //
    samplesheet = "/home/kothai/cq-git-sample/Variantcalling-and-Genefusion/data/test/sample_sheet_new.csv"
    
	
	
	 // ========================== Download URLs ========================== //
    genome_download_url = "https://github.com/kothaiRaja/test_data/raw/refs/heads/master/reference_files/genome.fa"
    genome_index_download_url = ""
    gtf_download_url = "https://github.com/kothaiRaja/test_data/raw/refs/heads/master/reference_files/annotations.gtf"
    denylist_download_url = "https://github.com/Boyle-Lab/Blacklist/raw/master/lists/hg38-blacklist.v2.bed.gz"
    variants_snp_download_url = "https://github.com/kothaiRaja/test_data/raw/refs/heads/master/reference_files/chr22.dbsnp146.hg38.vcf.gz"
    variants_snp_index_download_url = "https://github.com/kothaiRaja/test_data/raw/refs/heads/master/reference_files/chr22.dbsnp146.hg38.vcf.gz.csi"
    variants_indels_download_url = "https://github.com/kothaiRaja/test_data/raw/refs/heads/master/reference_files/chr22.Mills_indels.hg38.vcf.gz"
    variants_indels_index_download_url = "https://github.com/kothaiRaja/test_data/raw/refs/heads/master/reference_files/chr22.dbsnp146.hg38.vcf.gz.csi"

	
    // ========================== Reference Files ========================== //
    reference_genome_path = "/home/kothai/cq-git-sample/Variantcalling-and-Genefusion/data/test/reference/genome.fa"
    reference_genome_index_path = ""
    reference_genome_dict_path = ""

    reference_genome_gtf = "/home/kothai/cq-git-sample/Variantcalling-and-Genefusion/data/test/reference/annotations.gtf"
    reference_denylist_path = "/home/kothai/cq-git-sample/Variantcalling-and-Genefusion/data/test/reference/hg38-blacklist.v2.bed"

    // ========================== Variant Calling Reference Files ========================== //
    variants_snp_path = "/home/kothai/cq-git-sample/Variantcalling-and-Genefusion/data/test/reference/chr22.dbsnp146.hg38.vcf.gz"
    variants_snp_index_path = "/home/kothai/cq-git-sample/Variantcalling-and-Genefusion/data/test/reference/chr22.dbsnp146.hg38.vcf.gz.csi"

    variants_indels_path = "/home/kothai/cq-git-sample/Variantcalling-and-Genefusion/data/test/reference/chr22.Mills_indels.hg38.vcf.gz"
    variants_indels_index_path = "/home/kothai/cq-git-sample/Variantcalling-and-Genefusion/data/test/reference/chr22.Mills_indels.hg38.vcf.gz.csi"

    star_genome_index_path = ""

    // ========================== Tool Paths ========================== //
    snpeff_jar_dir_path = ""
    snpeff_jar_path = "${params.snpeff_jar_dir_path}/snpEff.jar"
    snpeff_config_path = "${params.snpeff_jar_dir_path}/snpEff.config"
    snpeff_db_dir_path = ""


    // Arriba RNA Fusion Tool
    arriba_tool_dir_path = ""
    arriba_known_fusions = "${baseDir}/sample_ARRIBA/known_fusions_chr22.tsv"
    arriba_blacklist = "${baseDir}/sample_ARRIBA/blacklist_chr22.tsv"
	arriba_version = '2.4.0'

    // VEP Cache Paths
    vep_cache_dir_path = "/home/kothai/cq-git-sample/vc_and_gf/data/test/Tools/VEP/vep_cache"
    vep_cache_dir = "/home/kothai/cq-git-sample/vc_and_gf/data/test/Tools/VEP/vep_cache"
	vep_plugins_dir_path = ""
	

	//======================VEP configurations=========================//
	
	ensembl_release  = "113"
	genome_assembly  = "GRCh38"
	species          = "homo_sapiens"
	cache_version 	=	113
	
	
	

    // ========================== Pipeline Behavior ========================== //
    concatenate = false
    only_qc = false    //setting to true, runs only quality control
	only_star = false
    skip_star = false
	run_fusion = true
	maftools = true

    // ========================== Fastp Trimming Config ========================== //
    fastp_extra = "--detect_adapter_for_pe --length_required 50"


    // ========================== STAR Config ========================== //
	
	aligned_bam_samplesheet = null  
	aligned_bam_folder      = null
	star_outdir = "${params.resultsdir}/multiqc_input"
	
    // ========================== STAR Config ========================== //

	read_length             = 101        // Read length of input data; used for setting --sjdbOverhang = read_length - 1
	star_ignore_sjdbgtf     = false      // If true, skip using the GTF file for splice junctions
	seq_platform            = 'ILLUMINA' // Sequencing platform (used in SAM header: PL tag)
	seq_center              = 'RBCT'     // Sequencing center name (used in SAM header: CN tag)

	// --- Intron alignment parameters ---
	star_alignIntronMin              = 20         // Minimum intron size for alignment
	star_alignIntronMax              = 1000000    // Maximum intron size for alignment

	// --- Splice junction settings ---
	star_alignSJoverhangMin          = 8          // Minimum overhang for a splice junction
	star_alignSJDBoverhangMin        = 1          // Minimum overhang when using annotated junctions from GTF

	// --- Mismatch and alignment filtering ---
	star_outFilterMismatchNmax       = 999        // Maximum number of mismatches (set high to rely on other filters)
	star_outFilterMatchNmin          = 16         // Minimum number of matched bases
	star_outFilterMatchNminOverLread = 0.2        // Minimum matched bases as a fraction of read length
	star_outFilterScoreMinOverLread  = 0.2        // Minimum alignment score as a fraction of read length
	star_mismatchNoverLmax           = 0.05       // Max mismatches per read length (useful for error rate filtering)
	star_outSAMmapqUnique            = 60         // MAPQ score to assign to uniquely mapped reads

	// --- Chimeric read detection (for fusion genes) ---
	star_chimSegmentMin            = 10         // Minimum length of a chimeric segment
	star_chimJunctionOverhangMin  = 10         // Minimum overhang at chimeric junction
	star_chimScoreJunctionNonGTAG = -4         // Penalty for non-GTAG junctions in chimera
	star_chimScoreMin             = 1          // Minimum total chimeric alignment score
	star_chimScoreDropMax         = 50         // Max drop in score to keep alternative chimeric alignment
	star_chimScoreSeparation      = 10         // Minimum score difference between top chimeric alignments

	// --- Extra STAR arguments (optional) ---
	star_extra_args = ''                      // Custom extra STAR options (e.g., '--outSAMattrIHstart 0')

	
    //==========================Intervals list parameters==============//
	scatterintervals = true
    scatter_count = 3
	// ========================== GATK Mark Duplicates ========================== //
    
    remove_duplicates = false
    validation_stringency = "STRICT"
	
	//============================Variant filter===============================//
	
	variant_filter_mode = "select"  // options: "select", "global"
	
	gatk_vf_qual_filter       = 30.0   // Filter variants with QUAL score < 30 (low confidence)
	gatk_vf_qd_filter         = 2.0    // Filter if Quality by Depth (QD) < 2 (low-quality support)
	gatk_vf_fs_filter         = 60.0   // Filter if Fisher Strand (FS) > 60 (strand bias)
	gatk_vf_mq_filter         = 40.0   // Filter if Mapping Quality (MQ) < 40 (poor read alignment)
	gatk_vf_sor_filter        = 3.0    // Filter if Symmetric Odds Ratio (SOR) > 3 (strand bias)
	gatk_vf_read_pos_filter   = -8.0   // Filter if ReadPosRankSum < -8 (variant near read ends)
	gatk_vf_baseq_filter      = -6.0   // Filter if BaseQRankSum < -6 (alt allele has low base quality)

	
	//============================Snpeff=================================//
	
	genomedb = 'GRCh38.105'
	
	//=============================Annotation_Tools====================//
	
	annotation_tools = ['combine'] 
	vep_plugin_flags = "--plugin LoF --plugin PolyPhen_SIFT --plugin CADD --plugin REVEL"
	
	//===========================ARRIBA visualisation==================//
	
	protein_domains = ""
	cytobands = ""
}

	

// ========================== Process Configuration ========================== //
// ========================== Resource Allocation for Labels ========================== //
process {
    withLabel: 'process_low' {
        cpus = 2
        memory = '8GB'
        time = '4h'
    }
    withLabel: 'process_medium' {
        cpus = 6
        memory = '36GB'
        time = '8h'
    }
    withLabel: 'process_high' {
        cpus = 12
        memory = '40GB'
        time = '16h'
    }
    withLabel: 'process_very_high' {
        cpus = 12
        memory = '40GB'
        time = '24h'
    }
}



// ========================== Custom Process Parameters ========================== //
process {
    withName: 'ANNOTATEVARIANTS_VEP' {
        ext.args = [
            '--fork 4',
            '--everything'
        ].join(' ').trim()
    }
}
